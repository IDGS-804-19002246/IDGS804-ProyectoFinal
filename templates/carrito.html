{% extends "layout.html" %}

{% block content %}
<div class="bg-light p-1"></div>
<div class="px-4 back h-100 fondo " style="--f:url(../static/img/fondo3.jpg)">

    <h2 class="text-light text-center" style="font-family: 'Cubano', sans-serif;">Mi Carrito</h2>

    <div id="carrito" class="row rounded bg-opacity" style="--co:#ffffff80;">
        <table class=" scroll text-center h-100 w-100 fw-bold">

            <thead class="d-block w-100 bg-danger text-light rounded-top">
                <tr class="d-block w-100">
                    <th>N°</th>
                    <th>Nombre</th>
                    <th>Precio Unidad / Mayoreo</th>
                    
                    <th>Total</th>
                    <th>Eliminar</th>

                </tr>
            </thead>

            <tbody class="d-block w-100">
                {%if C != ''%}
                {% for c in C %}
                <tr class="d-block w-100">
                    <td>
                        <div class="d-inline-block">
                            <a href="carrito_edit?id={{c.id_producto}}&n={{c.numero - 1}}&l={{c.cantidad - c.cantidad_min}}"><button
                                    class="rounded-pill px-2"><i class="bi bi-dash-square-fill"></i></button></a>
                        </div>
                        <div class="bloque">{{c.numero}}</div>
                        <div class="d-inline-block">
                            <a
                            href="carrito_edit?id={{c.id_producto}}&n={{c.numero + 1}}&l={{c.cantidad - c.cantidad_min}}"><button
                                class="rounded-pill px-2"><i class="bi bi-plus-square-fill"></i></button></a>
                        </div>
                        
                    </td>

                    <td>{{c.nombre}}</td>
                    <td>${{c.precio_U}} / ${{c.precio_M}}</td>
                    
                    <td class="item">$
                        {% if  9 >= c.numero  %}
                            {{c.precio_U * c.numero}}
                        {% else %}
                            {{c.precio_M * c.numero}}
                        {% endif %}
                    </td>

                    <td><a href="carrito_edit?id={{c.id_producto}}&n=0&l={{c.cantidad - c.cantidad_min}}"><button
                                class="rounded-pill btn-warning px-3"><i class="bi bi-trash3-fill"></i></button></a>
                    </td>
                </tr>
                {% endfor %}
                {%endif%}

            </tbody>
        </table>

        <footer class="p-4 bg-danger rounded-bottom">
            {% with messages = get_flashed_messages() %}{% if messages %}
            <h4 class="text-light text-center fw-bold">{{ messages[0] }}</h4>
            {% endif %}{% endwith %}

            {%if C == '' %}
                {% with messages = get_flashed_messages() %}{% if not messages %}
                    <h4 class="text-light text-center fw-bold">No hay productos</h4>
                {% endif %}{% endwith %}
            {%else%}
                <h4 id="Total" class="text-light fw-bold w-50 d-inline-block">Precio Total: </h4>

                <form action="/carrito" method="post" class="d-inline-block" id="for">
                    <input type="hidden" name="csrf_token" value="{{csrf_token()}}" />
                    <div class="d-inline-block text-light fw-bold py-2">
                        <label>Envio: </label><input type="checkbox" name="env" id="env" onchange="envio(this)">
                    </div>
                    <div class="d-inline-block text-light fw-bold py-2">
                        <label>Direccion: </label><input type="text" name="dir" id="dir">
                    </div>
                    <div class="d-inline-block fw-bold py-2">
                        <button type="submit" class="btn btn-light mx-2">Compar</button>
                        <button type="button" class="btn btn-light mx-2"
                            onclick="
                            document.cookie = 'carrito=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                            window.location.reload();">Vaciar
                            Carrito</button>
                    </div>

                </form>
            {%endif%}


            

            
        </footer>

        {{C}}

    </div>
</div>

<script>
    window.addEventListener('load', () => {
        var total = 0;
        $('.item').each(function () { total += parseInt(this.textContent.slice(1, -1)) });
        $('#Total').text('Precio Total: $' + total + '.00')

        $('#for')[0].reset();
        $('#dir').val('');
    })
    function envio(btn) {
        if (btn.checked == true) {
            Swal.fire({
                title: 'Envio de su compra',
                text: "¿Esta seguro de incluir envio a su compra?",
                icon: 'question',
                showCancelButton: false,
                showDenyButton: true,
                confirmButtonText: 'Sí, lo quiero por envio',
                confirmButtonColor: '#3085d6',
                denyButtonText:'No quiero el envio',
                denyButtonColor: '#d33'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#dir').prop('required', true);
                }
                if (result.isDenied) {
                    $('#dir').removeAttr("required");
                    $('#env')[0].checked = false;
                }
            })
        }else{
            $('#dir').removeAttr("required");
        }
    }
</script>
{% endblock content %}